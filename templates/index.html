<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HP Warranty Checker</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Roboto+Slab:wght@400;600&display=swap"
    rel="stylesheet">


  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1140px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
    }

    .form-section {
      flex: 0 0 60%;
      padding: 0px;
      /* background-color: #F3F4FE; */
      border-radius: 8px;
    }

    .form-section h2 {
      color: #1a40ff;
      font-size: 48px;
      font-family: 'Roboto Slab', serif;
      margin-bottom: 16px;
      font-weight: 400;
    }

    label {
      display: block;
      margin: 0px 0 16px 0px;
      font-size: 14px;
      font-family: 'poppins', serif;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: white !important;
      font-size: 16px;
    }

    button {
      margin-top: 16px;
      width: 100%;
      padding: 14px;
      font-size: 14px;
      font-weight: 400;
      color: #fff;
      background-color: #1a40ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.3s ease;
      font-family: 'poppins', serif;
    }

    button:hover {
      background-color: #1533cc;
      border: none;
    }

    #loader {
      margin-top: 10px;
      color: #666;
      font-family: 'poppins', serif;
    }

    .image-section {
      flex: 0 0 40%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
    }

    .image-section img {
      max-width: 100%;
      height: auto;
    }

    #result {
      margin-top: 30px;
      max-width: 1140px;
      width: 100%;
    }


    .product-info-flex {
      display: flex;
      align-items: center;
      gap: 28px;
      margin-bottom: 20px;
      border: 1px solid #BAC3FF;
      border-radius: 8px;
      padding: 16px;
      background: #FBFBFF;
      width: 100%;
    }

    .product-image img {
      width: 150px;
      height: auto;
    }

    .product-text h2 {
      margin: 0 0 0px;
      font-size: 32px;
      color: #1A45EF;
      font-family: 'Roboto Slab', serif;
      font-weight: 400;

    }

    .product-image {
      width: 20%;
    }

    .product-serial-flex {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      font-size: 14px;
      margin: 16px 0px;
      font-family: 'Roboto Slab', serif;

    }


    .warranty-boxes {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin: 20px 0;
    }

    .box {
      flex: 1 1 180px;
      background: #fff;
      border: 1px solid #d6dff2;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
    }

    .box p {
      margin: 0;
      font-size: 14px;
      color: #00115A;
      font-family: 'poppins', serif;
    }

    .box strong {
      display: block;
      margin-top: 5px;
      font-size: 16px;
      color: #222;
    }

    .box .blue {
      color: #1F48F0;
      font-weight: 600;
      font-family: 'Roboto Slab', serif;
      font-size: 16px;

    }

    .product-text {
      margin: 8px 0px;
      width: 80%;
    }

    .status-box {
      margin-top: 10px;
      background-color: #fff;
      padding: 10px 12px;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid transparent;
      border-radius: 5px;
    }

    .status-box p {
      margin: 4px 0;
      font-size: 14px;
    }

    .status-active {
      color: green;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-expired {
      color: red;
      background: #FFFAFA;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-expiring {
      color: #D4A400;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-upcoming {
      color: #878787;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;
    }


    .status-expiring-border {
      border-color: #D4A400 !important;
      /* Amber color for warning */
    }

    .status-active-border {
      border-color: green;
    }

    .status-expired-border {
      border-color: red;
    }

    .status-upcoming-border {
      border-color: #878787;
    }

    .status-active {
      color: green;
    }

    .care-pack-wrapper {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      width: 1140px;
      padding: 30px 0;
      gap: 20px;
    }

    .care-pack-card {
      border: 1px solid #DEE0FF;
      border-radius: 8px;
      text-align: left;
      background-color: white;
    }

    .price-cart {
      display: flex;
      justify-content: space-between;

    }




    .img-wrapper {
      text-align: center;
      background: #F0EFFF;
      padding: 16px;
      border-radius: 8px 8px 0px 0px;
      position: relative;


    }

    .img-wrapper img {
      max-width: 220PX;
      height: auto;

      border-radius: 8PX;
    }

    .sku {
      color: #00115a;
      font-size: 12px;
      text-transform: uppercase;
      padding: 16px;
      font-family: 'poppins', serif;

    }

    .title {
      font-family: 'Roboto Slab', serif;
      font-size: 16px;
      font-weight: 400;
      color: #00115A;
      padding: 0px 16px;
      height: 72px;

    }

    .title a {
      color: #00115A !important;
      text-decoration: none;



    }

    .price-cart {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
    }

    .price {
      font-weight: 400;
      color: #00115A;
      font-family: 'poppins', serif;
      font-size: 16px;

    }

    .buy-link {
      color: #1F48F0;
      font-weight: 600;
      font-family: 'poppins', serif;
      font-size: 14px;
    }



    .tag-label {
      position: absolute;
      top: 20px;
      left: 10px;
      font-size: 12px;
      font-weight: 500;
      padding: 5px 16px;
      border-radius: 50px;
      color: white;
      z-index: 1;
      width: 155px;
      font-family: 'poppins', serif;



    }

    .tag-customer {
      background-color: #0031C6;
    }

    .tag-smart {
      background-color: #107F10;
    }

    .tag-essentials {
      background-color: #00115a;
    }

    .no-plan-wrapper {
      width: 1140px;
    }

    .warranty-form {
      background: #F3F4FE;
      padding: 24px;
      border-radius: 8px;
    }

    .product-id-section {
      background-color: #F0EFFF;
      padding: 40px 20px;
      width: 100%;
    }

    .content-wrapper {
      max-width: 1140px;
      margin: 0 auto;
      text-align: center;
      font-family: 'Poppins', sans-serif;
    }

    .product-id-section h2 {
      font-size: 61px;
      color: #333;
      text-align: left;
      font-family: 'Roboto Slab', serif;
      font-weight: 100;
      line-height: normal;
    }

    .product-id-section p {
      font-size: 16px;
      color: #555;
      margin: 28px 0px;
      text-align: left;
      font-family: 'Roboto Slab', serif;
      color: #00115A;
    }

    .product-id-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }

    .product-id-box {
      text-align: center;
    }

    .product-id-box img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .product-id-box h4 {
      margin-top: 12px;
      font-size: 16px;
      font-weight: 400;
      color: #000;
      text-align: left;
      margin-bottom: 8px;
      font-family: Poppins;
    }

    .carepack-header {
      display: flex;
      justify-content: space-between;
      align-items: center !important;
    }

    .carepack-header h2 {
      color: #1A45EF;
      font-family: 'Roboto Slab', serif;
      font-size: 48px;
      font-weight: 400;
      margin: 0;
    }

    .reminder-heading {
      color: #1A45EF;
      font-family: 'Roboto Slab', serif;
      font-size: 36px;
      margin-bottom: 20px;
    }

    .reminder-wrapper {
      display: flex;
      align-items: center;
      max-width: 1140px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 0px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .reminder-form-box {
      flex: 0 0 60%;
      padding: 24px;
      border-radius: 8px;
      background: #FBFBFF;
      border: 1px solid #eee;
      font-family: Poppins, sans-serif;
    }

    .reminder-form-box p {
      font-size: 16px;
      line-height: 1.5;
      color: #00072E;
      margin-bottom: 12px;
    }

    .reminder-image {
      flex: 1;
      text-align: center;
    }

    .reminder-image img {
      max-width: 100%;
      height: auto;
    }

    html {
      scroll-behavior: smooth;
    }

    #result {
      scroll-margin-top: 40px;
    }

    .container1 {
      max-width: 700px;
      margin: auto;
    }

    .container1 h3 {
      text-align: left;
      color: #1a40ff;
      font-size: 34px;
      margin-bottom: 16px;
      font-family: 'Poppins', serif;
    }

    .container-email {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 40px;
    }

    .image-box {
      flex: 1;
      max-width: 260px;
    }

    .image-box img {
      width: 100%;
      height: auto;
    }

    .form-box {
      flex: 1;
      max-width: 381px;
      width: 100%;
    }

    .form-box input {
      width: 100%;
      margin-bottom: 16px;
      font-size: 14px;
      border-radius: 5px;
      padding: 12px;
      border: none;
      background: #f0efff !important;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    .form-box button {
      width: 100%;
      padding: 12px;
      font-family: 'Poppins', sans-serif;
      background: #1a40ff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      margin: 0px;
    }
.skeleton-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0px 0px 16px 0px;
  width: 100%;
    margin: 0px auto;

}

.skeleton-container {
  width: 100%;
  max-width: 1140px;
  background: white;
  border-radius: 12px;
  padding: 32px;
  margin: 0px auto;
  animation: pulse 1.5s infinite ease-in-out;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
  box-sizing: border-box;
}

.skeleton-header {
  display: flex;
  align-items: flex-start;
  gap: 20px;
  margin-bottom: 24px;
}

.skeleton-thumbnail {
  width: 100px;
  height: 100px;
  border-radius: 8px;
  background: linear-gradient(90deg, #eee 25%, #ddd 50%, #eee 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

.skeleton-header-lines {
  flex: 1;
}

.skeleton-line {
  height: 20px;
  background: linear-gradient(90deg, #eee 25%, #ddd 50%, #eee 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: 6px;
  margin-bottom: 12px;
  width: 100%;
}

.skeleton-line.short {
  width: 70%;
}

.skeleton-line.xshort {
  width: 40%;
  height: 14px;
}

.skeleton-grid {
  display: flex;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.skeleton-box {
  flex: 1 1 22%;
  height: 80px;
  border-radius: 8px;
  background: linear-gradient(90deg, #eee 25%, #ddd 50%, #eee 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  min-width: 150px;
}

/* Animation */
@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}


    @media (max-width: 480px) {
      .container {
        flex-direction: column;
        /* stack items vertically */
        align-items: center;
        background-color: #FFF;
        padding: 16px;
        border-radius: 0px !important;
      }
      button {
      margin-top: 4px;
      width: 100%;
      padding: 14px;
      font-size: 14px;
      font-weight: 400;
      color: #fff;
      background-color: #1a40ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.3s ease;
      font-family: 'poppins', serif;
    }

      .form-section h2 {
        color: #1a40ff;
        font-size: 26px;
        font-family: 'Roboto Slab', serif;
        margin-bottom: 16px;
        font-weight: 400;
      }

      .form-section,
      .image-section {
        width: 100%;
        /* take full width */
      }

      .warranty-form {
        background: #f3f4fe;
        padding: 16px;
        border-radius: 8px;
      }

      .form-section {

        order: 2;
        /* form appears below */
      }

      .image-section {
        order: 1;
        /* image appears on top */
      }

      .product-info-flex {
        padding: 0 !important;
        display: block;
        margin-bottom: 20px;
        border: none;
        border-radius: 8px;
        padding: 16px;
        width: 100%;
        background-color: white;
      }

      .product-serial-flex {
        display: block;
      }

      .product-text {
        width: 100%;
      }

      .care-pack-wrapper {
        width: 100%;
        display: grid;
        grid-template-columns: auto;
      }

      .product-image {
        width: 100%;

      }

      .product-image img {
        width: 318px;
        height: 238px;
        display: block;
        margin: 0px auto;

      }

      #result {
        padding: 21px;
        margin: 0px;
      }

      .warranty-boxes {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin: 0px;
      }

      .box {
        width: calc(50% - 10px);
        /* two boxes per row with gap */
        background: #eef;
        padding: 16px;
        box-sizing: border-box;
        flex: none;
      }

      .box .blue {
        color: #1F48F0;
        font-weight: 600;
        font-family: 'Roboto Slab', serif;
        font-size: 14px;
      }

      .box p {
        margin: 0;
        font-size: 12px;
        color: #00115A;
        font-family: 'poppins', serif;
      }

      #compatible-packs {
        padding: 21px;
        width: 100%;
        background-color: #FBFBFF;
      }

      .product-id-section {
        padding: 30px 16px;
        background-color: #F0EFFF;
      }

      .product-id-section h2 {
        font-size: 24px;
        line-height: 1.3;
        margin-bottom: 8px;
      }

      .product-id-section p {
        font-size: 14px;
        margin: 16px 0px;
      }

      .product-id-grid {
        grid-template-columns: repeat(2, 1fr);
        /* 2 columns on mobile */
        gap: 20px;
      }

      .product-id-box img {
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .product-id-box h4 {
        font-size: 14px;
        margin-top: 8px;
      }

      .carepack-header {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: unset !important;
      }

      .carepack-header h2 {
        color: #1A45EF;
        font-family: 'Roboto Slab', serif;
        font-size: 26px;
        font-weight: 400;
        margin: 0;
      }

      .reminder-wrapper {
        flex-direction: column;
        margin: 0px !important;
        gap: 0px
      }

      .reminder-form-box,
      .reminder-image {
        flex: 1 1 100%;
        max-width: 100%;
      }

      .reminder-heading {
        font-size: 24px;
        text-align: left;
      }

      .reminder-form-box p {
        font-size: 14px;
      }

      #openModalBtn {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100% !important;
        border-radius: 0;
        padding: 16px;
        font-size: 16px;
        z-index: 9999;
        text-align: center;
        font-family: poppins !important;
      }

      html {
        scroll-behavior: smooth;
      }

      #result {
        scroll-margin-top: 40px;
      }

      .no-plan-wrapper {
        width: auto;
      }

      .container1 {
        max-width: 318px;
        margin: auto;
      }

      .container1 h3 {
        text-align: left;
        color: #1a40ff;
        font-size: 27px;
        margin-bottom: 16px;
        font-family: 'Poppins', serif;
      }

      .container-email {
        gap: 20px;
        display: block;

      }

      .image-box {
        flex: 1;
        max-width: 260px;
        margin: 0px auto;
      }

      .image-box img {
        width: 100%;
        height: auto;
      }

      .form-box {
        flex: 1;
        max-width: 381px;
        width: 100%;
      }

      .form-box input {
        width: 100%;
        margin-bottom: 16px !important;
        font-size: 14px;
        border-radius: 5px;
        padding: 12px;
        border: none;
        background: #f0efff !important;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
      }

      .form-box button {
        width: 100%;
        padding: 12px;
        font-family: 'Poppins', sans-serif;
        background: #1a40ff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        font-size: 14px;
        margin: 0px;
      }



    }
  </style>
</head>

<body>

  <div class="container">
    <div class="form-section">
      <h2>Check your Warranty</h2>
      <form class="warranty-form" onsubmit="event.preventDefault(); checkWarranty();">
        <label>Enter Your HP Device Serial Number</label>

        <input type="text" id="serial" placeholder="Eg: 5CD137LZF9" required oninput="
          let rawSerial = this.value.replace(/\s/g, ''); // remove whitespaces
          this.value = rawSerial.substring(0, 10); // allow only 10 chars
          document.getElementById('product').value = '';
          document.getElementById('product-container').style.display = 'none';
          document.getElementById('serial-error').innerHTML = '';
          document.getElementById('result').innerHTML = '';
          document.getElementById('compatible-packs').innerHTML = '';
          document.getElementById('loader').style.display = 'none';
        ">
        <div id="serial-error" style="margin-bottom: 10px;"></div>

        <div id="product-container" style="display: none;">
          <label>Enter Your HP Device Product Number</label>
          <input type="text" id="product" oninput="
            let rawProduct = this.value.replace(/\s/g, ''); // remove whitespaces
            this.value = rawProduct.substring(0, 15); // allow only 7 chars
          ">
        </div>

        <button type="submit" id="submitBtn">Show Warranty Plans</button>
        <a href="https://arminfoserve.com/care-pack-product/" target="_blank"
          style="display: block; font-size: 14px;font-weight: 500;font-family: poppins; text-decoration: none; margin: 8px auto 0; color: #1F48F0; text-align: center;">
          I dont have serial number
        </a>
        <!-- <div id="loader" style="display:none;">üîç Checking warranty‚Ä¶ Please wait.</div> -->
      </form>
    </div>

    <div class="image-section">
      <img src="https://arminfoserve.com/wp-content/uploads/2025/05/Group-1116599858.png"
        alt="Warranty Check Illustration">
    </div>
  </div>
 <div id="loader" class="skeleton-wrapper" style="display: none;">
  <div class="skeleton-container">
    <div class="skeleton-header">
      <div class="skeleton-thumbnail"></div>
      <div class="skeleton-header-lines">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line xshort"></div>
        <div class="skeleton-line xshort"></div>
      </div>
    </div>
    <div class="skeleton-line"></div>
    <div class="skeleton-grid">
      <div class="skeleton-box"></div>
      <div class="skeleton-box"></div>
      <div class="skeleton-box"></div>
      <div class="skeleton-box"></div>
    </div>
  </div>
</div>


  

  <!-- Warranty Result Output Below Container -->
  <div id="result" style="display: none; margin-top: 0;"></div>
  <div id="compatible-packs" style="display: none; margin-top: 0;"></div>
  <section class="product-id-section">
    <div class="content-wrapper">
      <h2>Find Your HP Product Number</h2>
      <p>Your HP device serial number is on the underside of your laptop, behind your desktop, or on the back of your
        printer.</p>

      <div class="product-id-grid">
        <div class="product-id-box">
          <h4>Laptop Product ID</h4>
          <img src="https://arminfoserve.com/wp-content/uploads/2024/10/Group-482389.png" alt="Laptop Product ID">
        </div>
        <div class="product-id-box">
          <h4>Desktop Product ID</h4>
          <img src="https://arminfoserve.com/wp-content/uploads/2024/10/Group-482390.png" alt="Desktop Product ID">
        </div>
        <div class="product-id-box">
          <h4>Monitor Product ID</h4>
          <img src="https://arminfoserve.com/wp-content/uploads/2024/10/Group-482391.png" alt="Monitor Product ID">
        </div>
        <div class="product-id-box">
          <h4>Printer Product ID</h4>
          <img src="https://arminfoserve.com/wp-content/uploads/2024/10/Group-482392.png" alt="Printer Product ID">
        </div>
      </div>
    </div>
  </section>

  <div id="emailModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
  background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:9999;">
    <div
      style="background:white;font-family:poppins; padding:20px; border-radius:8px; position:relative; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
      <span onclick="closeModal()"
        style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:18px;">‚úñ</span>
      <div class="container1">
        <h3>Send details to my email</h3>

        <div class="container-email">

          <div class="image-box">
            <img src="https://arminfoserve.com/wp-content/uploads/2025/07/Group-1116599938.png"
              alt="Laptop illustration">
          </div>

          <div class="form-box">
            <input type="text" id="name" placeholder="Name">
            <input type="tel" id="number" placeholder="Phone Number">
            <input type="email" id="email" placeholder="Email Address">
            <button onclick="sendReport()">Send!</button>
          </div>

        </div>



        <script>
          


// üîê Store role received from WordPress
window.addEventListener("message", function (event) {

  console.log("Incoming message from:", event.origin);

  // ‚úÖ Allow both www and non-www
  if (!event.origin.includes("arminfoserve.com")) return;

  if (event.data?.type === "USER_ROLE") {
    window.USER_ROLE = event.data.role || "guest";
    console.log("üîê Role received from WordPress:", window.USER_ROLE);
  }

});


         ///////////////////////////////////////////////////////////////////////////////
// üîµ REQUIRED ‚Äî Add this at TOP to enable auto-run correctly
///////////////////////////////////////////////////////////////////////////////
let serialAlreadyProcessed = false;


///////////////////////////////////////////////////////////////////////////////
// üîµ STEP 4 ‚Äî RECEIVE SERIAL FROM WORDPRESS & AUTO-SUBMIT
///////////////////////////////////////////////////////////////////////////////
window.addEventListener("message", function (event) {

    if (event.data.serial && !serialAlreadyProcessed) {
        serialAlreadyProcessed = true;

        const serial = event.data.serial;

        const input = document.getElementById("serial");
        if (input) input.value = serial;

        if (typeof submitForm === "function") {
            submitForm({ preventDefault: () => {} });
        }
    }
});


///////////////////////////////////////////////////////////////////////////////
// üü¢ STEP 5 ‚Äî SEND SERIAL BACK TO WORDPRESS AFTER WARRANTY RESULT LOADS
///////////////////////////////////////////////////////////////////////////////
function notifyParentAfterResult(serial, productNumber, endDate) {
  window.parent.postMessage(
    {
      serialDone: true,
      serial: serial,
      productNumber: productNumber,
      endDate: endDate
    },
    "*"
  );
}

          
          function sendReport() {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const number = document.getElementById("number").value;
            const result = window.latestWarrantyResult;

            if (!name || !email || !result) {
              alert("‚ùå Please fill all fields and run a warranty check first.");
              return;
            }

            console.log("üì® Sending report:", { name, email, result }); // Optional debug

            fetch("/send_email", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ name, email, number, result })
            })
              .then((res) => res.json())
              .then((data) => {
                alert(data.message);
                closeModal();
              })
              .catch(() => alert("‚ùå Failed to send email"));
          }
         
          function getU9WX1EPrice(productName, productNumber) {
            const name = (productName || productNumber || "").toLowerCase();

            if (name.includes("spectre")) return "‚Çπ18,500";
            if (name.includes("omen") || name.includes("envy")) return "‚Çπ12,500";
            if (name.includes("pavilion") || name.includes("victus")) return "‚Çπ10,500";
            if (name.includes("14") || name.includes("15") || name.includes("chromebook")) return "‚Çπ8,500";

            return "SELECT THE MODEL";
          }



          let latestResult = null;
           // store latest result


          function openModal() {
            document.getElementById("emailModal").style.display = "flex";
          }

          function closeModal() {
            document.getElementById("emailModal").style.display = "none";
          }

          // Event delegation since button is dynamically injected
          document.addEventListener("click", function (e) {
            if (e.target && e.target.id === "openModalBtn") {
              openModal();
            }
          });

          function checkWarranty() {
            const serial = document.getElementById('serial').value.trim();
            const product = document.getElementById('product').value.trim();
            const button = document.getElementById("submitBtn");
    // button.disabled = true;

    // // Change color on submit
    // button.style.backgroundColor = "#E5E2E1";
    // button.style.color = "#ADAAAA";
    // button.textContent = "Checking...";

    // Simulate request delay (remove this when integrating with real function)
    
  

            // Add your validation or AJAX logic here.
            console.log('Checking for', serial, product);
          }
          function getTagClass(tag) {
            switch ((tag || "").toLowerCase()) {
              case "essentials": return "tag-essentials";
              case "smart pick": return "tag-smart";
              case "customer favourite": return "tag-customer";
              default: return "";
            }
          }



          async function submitForm(event) {
  event.preventDefault();

  const loader = document.getElementById("loader");
  const resultEl = document.getElementById("result");
  const packsEl = document.getElementById("compatible-packs");
  const errorEl = document.getElementById("serial-error");
  const button = document.getElementById("submitBtn");

  // üëâ Button loading state
  button.disabled = true;
  button.style.backgroundColor = "#E5E2E1";
  button.style.color = "#6F797A";
  // button.textContent = "Checking..."; // Optional

  loader.style.display = "block";
  resultEl.innerHTML = "";
  packsEl.innerHTML = "";
  errorEl.innerHTML = "";

  const serial = document.getElementById("serial").value.trim();
  const product = document.getElementById("product").value.trim();
  const serialRegex = /^[A-Za-z0-9]{10}$/;

  if (!serialRegex.test(serial)) {
    loader.style.display = "none";
    errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
      Verify that your serial number is entered correctly.
    </p>`;

    // üëâ Reset button if validation fails
    button.disabled = false;
    button.style.backgroundColor = ""; // reset to original
    button.style.color = ""; // reset to original
    return;
  }

  try {
    const resp = await fetch("/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
body: JSON.stringify({
  serial,
  product,
  role: window.USER_ROLE || "guest"
})
    });

    if (!resp.ok) throw new Error(await resp.text());
    const data = await resp.json();
    loader.style.display = "none";

    if (data.error) {
      if (data.error.toLowerCase().includes("product number")) {
        document.getElementById("product-container").style.display = "block";
      }

      errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
        ${data.error}
      </p>`;
    } else {
      renderResult(data, serial);
    }
  } catch (err) {
    loader.style.display = "none";
    errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
      Something went wrong: ${err.message}
    </p>`;
  } finally {
    // üëâ Reset button state after everything
    button.disabled = false;
    button.style.backgroundColor = ""; // Or original like "#1F48F0"
    button.style.color = ""; // Or original like "#fff"
    // button.textContent = "Show Warranty Plans"; // Optional if you had changed it
  }

  document.getElementById("result").style.display = "block";
  document.getElementById("compatible-packs").style.display = "block";

  const resultSection = document.getElementById("result");
  if (resultSection) {
    resultSection.scrollIntoView({ behavior: "smooth" });
  }


            document.getElementById("compatible-packs").style.marginTop = "0px"; // only if neede
          }

function buildProductUrl(packUrl, serial, productNumber, endDate) {
  const url = new URL(packUrl);
  url.searchParams.set("serial", serial);
  url.searchParams.set("pn", productNumber);
  url.searchParams.set("end", endDate);
  return url.toString();
}


          function renderResult(data, serial) {
            window.latestWarrantyResult = { ...data, serial };


            const resultEl = document.getElementById("result");
            const packsEl = document.getElementById("compatible-packs");
notifyParentAfterResult(
  serial,
  data.product_number,
  data.end_date
);

            // üí° Helper: Dynamic pricing for U9WX1E
            // function getU9WX1EPrice(productName) {
            //   const name = (productName || "").toLowerCase();
            //   if (name.includes("spectre")) return "‚Çπ12,500";
            //   if (name.includes("omen") || name.includes("envy")) return "‚Çπ10,500";
            //   if (name.includes("pavilion") || name.includes("victus")) return "‚Çπ9,500";
            //   if (name.includes("14") || name.includes("15") || name.includes("chromebook")) return "‚Çπ8,599";
            //   return "SELECT THE MODEL";
            // }


            // 1. Inject compatible care packs
            if (data.care_packs && data.care_packs.length) {
              const carePackHTML = `


<div class="carepack-header">
  <h2 >
    Compatible Care Packs
  </h2>
  <button id="openModalBtn"
    style="padding: 10px 20px;width:auto; background: #1a40ff;font-family: 'Poppins', serif; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Send details to my email
  </button>
</div>
        <div class="care-pack-wrapper">
          
        ${data.care_packs
  .map(pack => {

    // üî• STEP 1 ‚Äî Dynamic override for U9WX1E SKU + URL
    if (pack.part === "U9WX1E") {

      const dynamicPrice = getU9WX1EPrice(
        data.product_name,
        data.product_number
      );

      if (dynamicPrice === "‚Çπ8,500") {
        pack.part = "U9WX1E-14s/15s";
        pack.url = "https://arminfoserve.com/product/hp-3-year-accidental-damage-protection-only-service-on-notebooks-14s-15s/";
      }
      else if (dynamicPrice === "‚Çπ10,500") {
        pack.part = "U9WX1E-Pavilion/Victus";
        pack.url = "https://arminfoserve.com/product/hp-3-year-accidental-damage-protection-only-service-on-notebooks-pavilion-victus/";
      }
      else if (dynamicPrice === "‚Çπ12,500") {
        pack.part = "U9WX1E-Omen/Envy";
        pack.url = "https://arminfoserve.com/product/hp-3-year-accidental-damage-protection-only-service-on-notebooks-omen-envy/";
      }
      else if (dynamicPrice === "‚Çπ18,500") {
        pack.part = "U9WX1E-Spectre";
        pack.url = "https://arminfoserve.com/product/hp-3-year-accidental-damage-protection-only-service-on-notebooks-spectre/";
      }
    }

    return `
      <div class="care-pack-card">
        <div class="img-wrapper">
          ${pack.tag
            ? `<div class="tag-label ${getTagClass(pack.tag)}">
                 ${pack.tag}
               </div>`
            : ""
          }
          <img src="${pack.image}" alt="${pack.title}" />
        </div>

        <p class="sku">SKU: ${pack.part}</p>

        <h3 class="title">
          <a href="${buildProductUrl(
            pack.url,
            serial,
            data.product_number,
            data.end_date
          )}" target="_blank">
            ${pack.title}
          </a>
        </h3>

        <div class="price-cart">
          <p class="price" style="display:ruby;">

            ${
              // ‚úÖ 1. Partner price FIRST (highest priority)
              pack.is_partner_price
                ? `
                  <span style="text-decoration:line-through;color:#9AA0A6;font-size:13px;">
                    ‚Çπ${
                      pack.regular_price != null
                        ? new Intl.NumberFormat("en-IN").format(Number(pack.regular_price))
                        : "-"
                    }
                  </span><br>

                  <span style="color:#00115A;font-weight:600;font-size:16px;">
                    ‚Çπ${
                      pack.price != null
                        ? new Intl.NumberFormat("en-IN").format(Number(pack.price))
                        : "-"
                    }
                  </span>
                `
                // ‚úÖ 2. Dynamic U9WX1E pricing
                : pack.part.startsWith("U9WX1E")
                ? `
                  <span style="color:#00115A;font-weight:600;font-size:16px;">
                    ${
                      getU9WX1EPrice(
                        data.product_name,
                        data.product_number
                      ) || "SELECT THE MODEL"
                    }
                  </span>
                `
                // ‚úÖ 3. Normal pricing
                : `
                  ‚Çπ${
                    pack.price != null
                      ? new Intl.NumberFormat("en-IN").format(Number(pack.price))
                      : "‚Äî"
                  }
                `
            }

          </p>

          <a class="buy-link"
            href="${buildProductUrl(
              pack.url,
              serial,
              data.product_number,
              data.end_date
            )}"
            target="_blank">
            PROCEED TO BUY
          </a>

        </div>
      </div>
    `;
  })
  .join("")}


        </div>`;
              packsEl.innerHTML = carePackHTML;
            } else {
              const productName = data.product_name || "This Product";
              const eoslDate = data.eosl_date;
              let daysToEOSL = null;
              let showPostWarrantyHeading = false;
              let showAllSetForNowForm = false;

              // ‚úÖ Parse EOSL date and calculate days
              if (eoslDate && eoslDate !== "Unknown") {
                const today = new Date();
                const eosl = new Date(eoslDate.split("-").reverse().join("-"));
                daysToEOSL = Math.floor((eosl - today) / (1000 * 60 * 60 * 24));
              }

              // ‚úÖ Check Post-Warranty Active Rule
              const actualServiceLevel = (data.actual_service_level || "").toLowerCase();
              const hasNextCoverageDay = actualServiceLevel.includes("next coverage day");
              const coverageType = (data.coverage_type || "").toLowerCase();

              if (hasNextCoverageDay && coverageType === "care pack" && data.start_date && data.end_date) {
                const start = new Date(data.start_date.split("-").reverse().join("-"));
                const end = new Date(data.end_date.split("-").reverse().join("-"));
                const totalMonths = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());

                if (totalMonths >= 11 && totalMonths <= 13) {
                  showPostWarrantyHeading = true;
                }
              }

             // ‚úÖ Check EOSL future condition (> 365 days) AND Time Remaining > 100 days
if (
  !showPostWarrantyHeading &&
  eoslDate &&
  eoslDate !== "Unknown" &&
  daysToEOSL > 365
) {
  if (data.start_date && data.end_date) {
    const end = new Date(data.end_date.split("-").reverse().join("-"));
    const today = new Date();
    const timeRemainingDays = Math.floor((end - today) / (1000 * 60 * 60 * 24));

    if (timeRemainingDays > 100) {
      showAllSetForNowForm = true;
    }
  }
}



              // ‚úÖ Case: Post Warranty Plan is Active
              if (showPostWarrantyHeading || showAllSetForNowForm) {
                const headingText = showPostWarrantyHeading
                  ? "Post Warranty Plan is Active"
                  : "All Set For Now";
                packsEl.innerHTML = `
        <h1 style="color:#1A45EF; font-family:'Roboto Slab', serif; font-size:36px; margin-bottom:20px;">
        ${showPostWarrantyHeading ? "Post Warranty Plan is Active" : "All Set For Now"}
      </h1>
      <div style="display: flex; align-items: center; max-width: 1140px; width: 100%; border-radius: 10px; overflow: hidden; margin-top: 30px; gap: 20px; flex-wrap: wrap;">
        <div style="flex: 0 0 60%; padding: 24px; border-radius: 8px; background:#FBFBFF; border: 1px solid #eee;">
          <p style="font-family:Poppins;font-size:16px; line-height: 1.5; color: #00072E;">Nothing to see here, No products found for now.</p>
          <p style="font-family:Poppins;margin-bottom:16px; line-height: 1.5; color: #00072E;font-size:16px;">But before you go, please share your details, so we can remind you to extend the warranty in time.</p>
            <form id="reminder-form">
              <input type="hidden" id="headingText" name="headingText" value="Post Warranty Plan is Active" />
              <input type="text" id="name" placeholder="Name" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
              <input type="tel" id="phone" placeholder="Phone Number" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
              <input type="text" id="serialNum" placeholder="Serial Number" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
              <button type="submit" id="submit-btn" style="width: 100%; padding: 14px; background-color: #1A45EF; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer;">SUBMIT</button>
            </form>
            <p id="email-status" style="font-family:Poppins; font-size:14px; margin-top: 8px;"></p>
          </div>
          <div class="reminder-image">
            <img src="https://arminfoserve.com/wp-content/uploads/2025/07/Webinar-rafiki-1.png" alt="Reminder Image">
          </div>
        </div>`;
              } else {
                // ‚ùå Case: EOSL expired or no match
                let eoslLine = "";
                if (eoslDate && daysToEOSL !== null && daysToEOSL <= 0) {
                  eoslLine = `
          <p style="font-family: 'Poppins', sans-serif; font-size: 14px; text-align:left; padding:16px 0px">
            Unfortunately, your device <strong>${productName}</strong> reached End-of-Support-Life on <strong>${eoslDate}</strong> and is no longer eligible for a warranty extension.
          </p>`;
                }

                packsEl.innerHTML = `
        <div class="no-plan-wrapper">
          <h2 style="color: #1A45EF; font-family: 'Roboto Slab', serif; font-size: 36px;">No Products found</h2>
          ${eoslLine}
          <img src="https://arminfoserve.com/wp-content/uploads/2025/06/Group-1000003714.png" alt="Product Not Found" style="width: 329px; height: 240px; max-width: 100%; margin: 20px auto; display:grid" />
          <a href="https://wa.link/zpjo1y" target="_blank" style="display: grid; background-color: #1A45EF; color: #fff; font-weight: 500; font-family: 'Poppins', sans-serif; padding: 12px 24px; border-radius: 8px; text-decoration: none; margin: 16px auto; width:360px;text-align:center;">
            Chat with us
          </a>
        </div>`;
              }
            }



            // 2. Inject main result card
            resultEl.innerHTML = `
      <div class="result-card">
        <div class="product-info-flex">
          <div class="product-image">
            ${data.image_url
                ? `<img src="${data.image_url}" alt="${data.product_name}"
                     />`
                : ""
              }
          </div>
          <div class="product-text">
          <h2>${data.product_name}</h2>
          <div class="product-serial-flex">
<p style="color:#00115A; font-size:14px; font-family:'poppins',serif;">Serial Number: <span style="color: #1f48f0; font-size:16px; font-family:'poppins',serif;">${serial}</span></p>


            <p style="color:#00115A; font-size:14px; font-family:'poppins',serif;">Product Number: <span style="color: #1f48f0; font-size:16px; font-family:'poppins',serif;">${data.product_number}</span></p>




          </div>
          <div class="status-box ${data.status === 'Active' ? 'status-active-border'
                : data.status === 'Coverage expiring' ? 'status-expiring-border'
                  : 'status-expired-border'}">
            <p><strong><span class="${data.status === 'Active' ? 'status-active'
                : data.status === 'Coverage expiring' ? 'status-expiring'
                  : 'status-expired'}">Status:</span> <span class="${data.status === 'Active' ? 'status-active'
                    : data.status === 'Coverage expiring' ? 'status-expiring'
                      : 'status-expired'}">${data.status}</span></strong></p>
            <p style="color: #00115A; font-size: 14px; font-family: 'Poppins', sans-serif;">
  <strong>Add-on ‚Äì</strong> ${data.addon}
</p>


          </div>
        </div>
      </div>

        </div>
        <div class="warranty-boxes">
          <div class="box">
            <p>Warranty Start Date</p>
            <strong class="blue">${data.start_date}</strong>
          </div>
          <div class="box">
            <p>Warranty End Date</p>
            <strong class="blue">${data.end_date}</strong>
          </div>
          <div class="box">
            <p>Coverage Type</p>
            <strong class="blue">${data.coverage_type}</strong>
          </div>
          <div class="box">
            <p>Time Remaining</p>
            <strong class="blue">${data.remaining_days}</strong>
          </div>
        </div>
      </div>`;
          }



          document
            .querySelector("form")
            .addEventListener("submit", submitForm);
          document.addEventListener("DOMContentLoaded", () => {
            const parent = document.querySelector("#compatible-packs");

            if (!parent) return;

            const formObserver = new MutationObserver(() => {
              const heading = parent.querySelector("h1")?.innerText.trim();
              const form = document.querySelector("#reminder-form");

              if (
                form &&
                (heading === "Post Warranty Plan is Active" || heading === "All Set For Now") &&
                !form.dataset.listenerAttached
              ) {
                form.dataset.listenerAttached = "true";

                form.addEventListener("submit", async function (e) {
                  e.preventDefault();
                  const headingText = document.getElementById("headingText")?.value.trim();


                  const name = document.getElementById("name")?.value.trim();
                  const phone = document.getElementById("phone")?.value.trim();
                  const serial = document.getElementById("serialNum")?.value.trim();
                  const submitBtn = document.getElementById("submit-btn");
                  const statusMsg = document.getElementById("email-status");

                  if (!name || !phone || !serial) {
                    statusMsg.textContent = "‚ùó All fields are required.";
                    return;
                  }

                  submitBtn.disabled = true;
                  submitBtn.innerText = "‚è≥ Sending...";
                  statusMsg.textContent = "";

                  try {
                    const res = await fetch("/submit-form", {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({ name, phone, serial, headingText })
                    });

                    const data = await res.json();
                    statusMsg.textContent = data.message || "‚úÖ Thank you!";
                  } catch (error) {
                    console.error("‚ùå Failed to send email", error);
                    statusMsg.textContent = "‚ùå Something went wrong. Please try again.";
                  }

                  submitBtn.disabled = false;
                  submitBtn.innerText = "SUBMIT";
                });
              }
            });

            formObserver.observe(parent, { childList: true, subtree: true });
          });

        </script>

</body>

</html>