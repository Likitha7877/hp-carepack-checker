<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HP Warranty Checker</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Roboto+Slab:wght@400;600&display=swap"
    rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1140px;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
    }

    .form-section {
      flex: 0 0 60%;
      padding: 0px;
      /* background-color: #F3F4FE; */
      border-radius: 8px;
    }

    .form-section h2 {
      color: #1a40ff;
      font-size: 48px;
      font-family: 'Roboto Slab', serif;
      margin-bottom: 16px;
      font-weight: 400;
    }

    label {
      display: block;
      margin: 0px 0 16px 0px;
      font-size: 14px;
      font-family: 'poppins', serif;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: white !important;
      font-size: 16px;
    }

    button {
      margin-top: 16px;
      width: 100%;
      padding: 14px;
      font-size: 14px;
      font-weight: 500;
      color: #fff;
      background-color: #1a40ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.3s ease;
      font-family: 'poppins', serif;
    }

    button:hover {
      background-color: #1533cc;
      border: none;
    }

    #loader {
      margin-top: 10px;
      color: #666;
      font-family: 'poppins', serif;
    }

    .image-section {
      flex: 0 0 40%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
    }

    .image-section img {
      max-width: 100%;
      height: auto;
    }

    #result {
      margin-top: 30px;
      max-width: 1140px;
      width: 100%;
    }


    .product-info-flex {
      display: flex;
      align-items: center;
      gap: 28px;
      margin-bottom: 20px;
      border: 1px solid #BAC3FF;
      border-radius: 8px;
      padding: 16px;
      background: #FBFBFF;
      width: 100%;
    }

    .product-image img {
      width: 150px;
      height: auto;
    }

    .product-text h2 {
      margin: 0 0 0px;
      font-size: 32px;
      color: #1A45EF;
      font-family: 'Roboto Slab', serif;
      font-weight: 400;

    }

    .product-image {
      width: 20%;
    }

    .product-serial-flex {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      font-size: 14px;
      margin: 16px 0px;
      font-family: 'Roboto Slab', serif;

    }


    .warranty-boxes {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin: 20px 0;
    }

    .box {
      flex: 1 1 180px;
      background: #fff;
      border: 1px solid #d6dff2;
      border-radius: 8px;
      padding: 15px;
      text-align: left;
    }

    .box p {
      margin: 0;
      font-size: 14px;
      color: #00115A;
      font-family: 'poppins', serif;
    }

    .box strong {
      display: block;
      margin-top: 5px;
      font-size: 16px;
      color: #222;
    }

    .box .blue {
      color: #1F48F0;
      font-weight: 600;
      font-family: 'Roboto Slab', serif;
      font-size: 16px;

    }

    .product-text {
      margin: 8px 0px;
      width: 80%;
    }

    .status-box {
      margin-top: 10px;
      background-color: #fff;
      padding: 10px 12px;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid transparent;
      border-radius: 5px;
    }

    .status-box p {
      margin: 4px 0;
      font-size: 14px;
    }

    .status-active {
      color: green;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-expired {
      color: red;
      background: #FFFAFA;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-expiring {
      color: #D4A400;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;

    }

    .status-upcoming {
      color: #878787;
      font-size: 16px;
      font-family: 'Poppins';
      font-weight: bold;
    }


    .status-expiring-border {
      border-color: #D4A400 !important;
      /* Amber color for warning */
    }

    .status-active-border {
      border-color: green;
    }

    .status-expired-border {
      border-color: red;
    }

    .status-upcoming-border {
      border-color: #878787;
    }

    .status-active {
      color: green;
    }

    .care-pack-wrapper {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      width: 1140px;
      padding: 30px 0;
      gap: 20px;
    }

    .care-pack-card {
      border: 1px solid #DEE0FF;
      border-radius: 8px;
      text-align: left;
      background-color: white;
    }

    .price-cart {
      display: flex;
      justify-content: space-between;

    }




    .img-wrapper {
      text-align: center;
      background: #F0EFFF;
      padding: 16px;
      border-radius: 8px 8px 0px 0px;
      position: relative;


    }

    .img-wrapper img {
      max-width: 220PX;
      height: auto;

      border-radius: 8PX;
    }

    .sku {
      color: #00115a;
      font-size: 12px;
      text-transform: uppercase;
      padding: 16px;
      font-family: 'poppins', serif;

    }

    .title {
      font-family: 'Roboto Slab', serif;
      font-size: 16px;
      font-weight: 400;
      color: #00115A;
      padding: 0px 16px;
      height: 72px;

    }

    .title a {
      color: #00115A !important;
      text-decoration: none;



    }

    .price-cart {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
    }

    .price {
      font-weight: 400;
      color: #00115A;
      font-family: 'poppins', serif;
      font-size: 16px;

    }

    .buy-link {
      color: #1F48F0;
      font-weight: 600;
      font-family: 'poppins', serif;
      font-size: 14px;
    }



    .tag-label {
      position: absolute;
      top: 20px;
      left: 10px;
      font-size: 12px;
      font-weight: 500;
      padding: 5px 16px;
      border-radius: 50px;
      color: white;
      z-index: 1;
      width: 155px;
      font-family: 'poppins', serif;



    }

    .tag-customer {
      background-color: #0031C6;
    }

    .tag-smart {
      background-color: #107F10;
    }

    .tag-essentials {
      background-color: #00115a;
    }

    .no-plan-wrapper {
      width: 1140px;
    }


    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        text-align: center;
      }

      .form-section,
      .image-section {
        width: 100%;
        padding: 30px 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="form-section">
      <h2>Check your Warranty</h2>
      <form style=" background: #F3F4FE; padding: 24px; border-radius: 8px;"
        onsubmit="event.preventDefault(); checkWarranty();">
        <label>Enter Your HP Device Serial Number</label>

        <input type="text" id="serial" placeholder="Eg: 5CD137LZF9" required oninput="
          let rawSerial = this.value.replace(/\s/g, ''); // remove whitespaces
          this.value = rawSerial.substring(0, 10); // allow only 10 chars
          document.getElementById('product').value = '';
          document.getElementById('product-container').style.display = 'none';
          document.getElementById('serial-error').innerHTML = '';
          document.getElementById('result').innerHTML = '';
          document.getElementById('compatible-packs').innerHTML = '';
          document.getElementById('loader').style.display = 'none';
        ">
        <div id="serial-error" style="margin-bottom: 10px;"></div>

        <div id="product-container" style="display: none;">
          <label>Enter Your HP Device Product Number</label>
          <input type="text" id="product" oninput="
            let rawProduct = this.value.replace(/\s/g, ''); // remove whitespaces
            this.value = rawProduct.substring(0, 7); // allow only 7 chars
          ">
        </div>

        <button type="submit">CHECK HP WARRANTY STATUS</button>
        <div id="loader" style="display:none;">üîç Checking warranty‚Ä¶ Please wait.</div>
      </form>
    </div>

    <div class="image-section">
      <img src="https://arminfoserve.com/wp-content/uploads/2025/05/Group-1116599858.png"
        alt="Warranty Check Illustration">
    </div>
  </div>

  <!-- Warranty Result Output Below Container -->
  <div id="result"></div>
  <div id="compatible-packs" style="margin-top: 20px;"></div>



  <script>

    function checkWarranty() {
      const serial = document.getElementById('serial').value.trim();
      const product = document.getElementById('product').value.trim();

      // Add your validation or AJAX logic here.
      console.log('Checking for', serial, product);
    }
    function getTagClass(tag) {
      switch ((tag || "").toLowerCase()) {
        case "essentials": return "tag-essentials";
        case "smart pick": return "tag-smart";
        case "customer favourite": return "tag-customer";
        default: return "";
      }
    }

    async function submitForm(event) {
      event.preventDefault();
      const loader = document.getElementById("loader");
      const resultEl = document.getElementById("result");
      const packsEl = document.getElementById("compatible-packs");
      const errorEl = document.getElementById("serial-error");
      loader.style.display = "block";
      resultEl.innerHTML = "";
      packsEl.innerHTML = "";
      errorEl.innerHTML = "";

      const serial = document.getElementById("serial").value.trim();
      const product = document.getElementById("product").value.trim();
      const serialRegex = /^[A-Za-z0-9]{10}$/;
      if (!serialRegex.test(serial)) {
        loader.style.display = "none";
        errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
        Verify that your serial number is entered correctly.
      </p>`;
        return;
      }

      try {
        const resp = await fetch(
          "/",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ serial, product })
          }
        );
        if (!resp.ok) throw new Error(await resp.text());
        const data = await resp.json();
        loader.style.display = "none";

        if (data.error) {
          if (data.error.toLowerCase().includes("product number")) {
            document.getElementById("product-container").style.display = "block";
          }
          errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
          ${data.error}
        </p>`;
        } else {
          renderResult(data, serial);
        }
      } catch (err) {
        loader.style.display = "none";
        errorEl.innerHTML = `<p style="color:#FF5544;font-size:10px">
        Something went wrong: ${err.message}
      </p>`;
      }
    }

    function renderResult(data, serial) {
      const resultEl = document.getElementById("result");
      const packsEl = document.getElementById("compatible-packs");


      // 1. Inject compatible care packs
      if (data.care_packs && data.care_packs.length) {
        const carePackHTML = `
<h2 style="color: #1A45EF; font-family: 'Roboto Slab', serif; font-size:48px; font-weight:400; ">Compatible Care Packs</h2>
        <div class="care-pack-wrapper">
          ${data.care_packs
            .map(pack => `
              <div class="care-pack-card">
                <div class="img-wrapper">
                  ${pack.tag
                ? `<div class="tag-label ${getTagClass(pack.tag)}">
                           ${pack.tag}
                         </div>`
                : ""
              }
                  <img src="${pack.image}" alt="${pack.title}" />
                </div>
                <p class="sku">SKU: ${pack.part}</p>
                <h3 class="title">
                  <a href="${pack.url}" target="_blank">
                    ${pack.title}
                  </a>
                </h3>
                <div class="price-cart">
                  <p class="price">‚Çπ${pack.price ?? "‚Äî"}</p>
                  <a class="buy-link" href="${pack.url}" target="_blank">
                    PROCEED TO BUY
                  </a>
                </div>
              </div>
            `)
            .join("")}
        </div>`;
        packsEl.innerHTML = carePackHTML;
      } else {
        const productName = data.product_name || "This Product";
        const eoslDate = data.eosl_date;
        let daysToEOSL = null;

        if (eoslDate && eoslDate !== "Unknown") {
          const today = new Date();
          const eosl = new Date(eoslDate.split("-").reverse().join("-")); // convert DD-MM-YYYY to YYYY-MM-DD
          daysToEOSL = Math.floor((eosl - today) / (1000 * 60 * 60 * 24));
        }

        const actualServiceLevel = (data.actual_service_level || "").toLowerCase();
        const showPostWarrantyHeading = actualServiceLevel.includes("next coverage day");


        // Case 1: EOSL is valid and more than 365 days left
        console.log("‚úÖ Debug Output:");
        console.log("‚Üí eoslDate:", eoslDate); // Should be "31-01-2028"
        console.log("‚Üí daysToEOSL:", daysToEOSL); // Should be > 365
        console.log("‚Üí actual_service_level:", actualServiceLevel); // Should include "next coverage day"
        console.log("‚Üí showPostWarrantyHeading:", showPostWarrantyHeading); // Should be true
        console.log("üß™ actual_service_level from backend:", data.actual_service_level);
        

        if (daysToEOSL !== null && daysToEOSL > 365) {
          packsEl.innerHTML = `
      <h1 style="color:#1A45EF; font-family:'Roboto Slab', serif; font-size:36px; margin-bottom:20px;">
        ${showPostWarrantyHeading ? "Post Warranty Plan is Active" : "All Set For Now"}
      </h1>
      <div style="display: flex; align-items: center; max-width: 1140px; width: 100%; border-radius: 10px; overflow: hidden; margin-top: 30px; gap: 20px; flex-wrap: wrap;">
        <div style="flex: 0 0 60%; padding: 24px; border-radius: 8px; background:#FBFBFF; border: 1px solid #eee;">
          <p style="font-family:Poppins;font-size:16px; line-height: 1.5; color: #00072E;">Nothing to see here, No products found for now.</p>
          <p style="font-family:Poppins;margin-bottom:16px; line-height: 1.5; color: #00072E;font-size:16px;">But before you go, please share your details, so we can remind you to extend the warranty in time.</p>

            <form id="reminder-form">
              <input type="hidden" id="headingText" name="headingText" value="${showPostWarrantyHeading ? "Post Warranty Plan is Active" : "All Set For Now"}" />
  <input type="text" id="name" placeholder="Name" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
  <input type="tel" id="phone" placeholder="Phone Number" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
  <input type="text" id="serialNum" placeholder="Serial Number" required style="width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;" />
  <button type="submit" id="submit-btn" style="width: 100%; padding: 14px; background-color: #1A45EF; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; letter-spacing: 1px;">SUBMIT</button>
</form>
<p id="email-status" style="font-family:Poppins; font-size:14px; margin-top: 8px;"></p>
        </div>


        <div style="flex: 0 0 35%; display: flex; justify-content: center; align-items: center;">
          <img src="https://arminfoserve.com/wp-content/uploads/2025/07/Webinar-rafiki-1.png" alt="Reminder Image" style="width: 350px; height: auto;" />
        </div>
      </div>
    `;
    
          // Case 2 & 3: EOSL is missing or within 365 days
        } else {
          let eoslLine = '';
          if (eoslDate) {
            eoslLine = `
      <p style="font-family: 'Poppins', sans-serif; font-size: 14px; text-align:left; padding:16px 0px">
        Unfortunately, your device <strong>${productName}</strong> reached End-of-Support-Life on <strong>${eoslDate}</strong> and is no longer eligible for a warranty extension.
      </p>
    `;
          }

          packsEl.innerHTML = `
    <div class="no-plan-wrapper">
      <h2 style="color: #1A45EF; font-family: 'Roboto Slab', serif; font-size: 36px;">No Products found</h2>
      ${eoslLine}
      <img src="https://arminfoserve.com/wp-content/uploads/2025/06/Group-1000003714.png" alt="Product Not Found" style="width: 329px; height: 240px; max-width: 100%; margin: 20px auto; display:grid" />
      
      <a href="https://wa.link/zpjo1y" target="_blank" style="display: grid; background-color: #1A45EF; color: #fff; font-weight: 500; font-family: 'Poppins', sans-serif; padding: 12px 24px; border-radius: 8px; text-decoration: none; margin: 16px auto; width:360px;text-align:center;">
        Chat with us
      </a>
    </div>
  `;
        }


      }
      

      // 2. Inject main result card
      resultEl.innerHTML = `
      <div class="result-card">
        <div class="product-info-flex">
          <div class="product-image">
            ${data.image_url
          ? `<img src="${data.image_url}" alt="${data.product_name}"
                    style="width:160px;margin-bottom:12px;" />`
          : ""
        }
          </div>
          <div class="product-text">
          <h2>${data.product_name}</h2>
          <div class="product-serial-flex">
<p style="color:#00115A; font-size:14px; font-family:'poppins',serif;">Serial Number:<span style="color: #1f48f0; font-size:16px; font-family:'poppins',serif;">${serial}</span></p>


            <p style="color:#00115A; font-size:14px; font-family:'poppins',serif;">Product Number:<span style="color: #1f48f0; font-size:16px; font-family:'poppins',serif;">${data.product_number}</span></p>




          </div>
          <div class="status-box ${data.status === 'Active' ? 'status-active-border'
          : data.status === 'Coverage expiring' ? 'status-expiring-border'
            : 'status-expired-border'}">
            <p><strong><span class="${data.status === 'Active' ? 'status-active'
          : data.status === 'Coverage expiring' ? 'status-expiring'
            : 'status-expired'}">Status:</span> ‚Äì <span class="${data.status === 'Active' ? 'status-active'
              : data.status === 'Coverage expiring' ? 'status-expiring'
                : 'status-expired'}">${data.status}</span></strong></p>
            <p style="color: #00115A; font-size: 14px; font-family: 'Poppins', sans-serif;">
  <strong>Add-on ‚Äì</strong> ${data.addon}
</p>


          </div>
        </div>
      </div>

        </div>
        <div class="warranty-boxes">
          <div class="box">
            <p>Warranty Start Date</p>
            <strong class="blue">${data.start_date}</strong>
          </div>
          <div class="box">
            <p>Warranty End Date</p>
            <strong class="blue">${data.end_date}</strong>
          </div>
          <div class="box">
            <p>Coverage Type</p>
            <strong class="blue">${data.coverage_type}</strong>
          </div>
          <div class="box">
            <p>Time Remaining</p>
            <strong class="blue">${data.remaining_days}</strong>
          </div>
        </div>
      </div>`;
    }

    // Utility to pick your border/text classes based on status
    // function statusClass(status) {
    //   switch (status) {
    //     case "Active": return "status-active-border";
    //     case "Coverage expiring": return "status-expiring-border";
    //     case "Upcoming": return "status-upcoming-border";
    //     default: return "status-expired-border";
    //   }
    // }

    document
      .querySelector("form")
      .addEventListener("submit", submitForm);
      document.addEventListener("DOMContentLoaded", () => {
  const parent = document.querySelector("#compatible-packs");

  if (!parent) return;

  const formObserver = new MutationObserver(() => {
    const heading = parent.querySelector("h1")?.innerText.trim();
    const form = document.querySelector("#reminder-form");

    if (
      form &&
      (heading === "Post Warranty Plan is Active" || heading === "All Set For Now") &&
      !form.dataset.listenerAttached
    ) {
      form.dataset.listenerAttached = "true";

      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const headingText = document.getElementById("headingText")?.value.trim();


        const name = document.getElementById("name")?.value.trim();
        const phone = document.getElementById("phone")?.value.trim();
        const serial = document.getElementById("serialNum")?.value.trim();
        const submitBtn = document.getElementById("submit-btn");
        const statusMsg = document.getElementById("email-status");

        if (!name || !phone || !serial) {
          statusMsg.textContent = "‚ùó All fields are required.";
          return;
        }

        submitBtn.disabled = true;
        submitBtn.innerText = "‚è≥ Sending...";
        statusMsg.textContent = "";

        try {
          const res = await fetch("/submit-form", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, phone, serial, headingText })
          });

          const data = await res.json();
          statusMsg.textContent = data.message || "‚úÖ Thank you!";
        } catch (error) {
          console.error("‚ùå Failed to send email", error);
          statusMsg.textContent = "‚ùå Something went wrong. Please try again.";
        }

        submitBtn.disabled = false;
        submitBtn.innerText = "SUBMIT";
      });
    }
  });

  formObserver.observe(parent, { childList: true, subtree: true });
});

  </script>

</body>

</html>